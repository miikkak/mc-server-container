# Pre-commit hooks configuration
# Install: pip install pre-commit
# Setup: pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # Standard pre-commit hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # Basic file checks
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-case-conflict
      - id: check-merge-conflict
      - id: check-symlinks
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: mixed-line-ending
        args: ['--fix=lf']

      # File format validation
      - id: check-yaml
      - id: check-json
      - id: check-toml
      - id: check-xml

      # Script validation
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable

      # Python validation (runs only if .py files present)
      - id: check-ast
      - id: check-docstring-first

      # Other useful checks
      - id: fix-byte-order-marker
      - id: detect-private-key

      # Prevent commits to main branch
      - id: no-commit-to-branch
        args: ['--branch', 'main', '--branch', 'master']

  # Shell script linting with shellcheck
  # Uses wrapper script to match GitHub Actions behavior (cd into each file's directory)
  - repo: local
    hooks:
      - id: shellcheck
        name: shellcheck
        entry: .shellcheck-wrapper.sh
        language: script
        types: [shell]
        files: \.(sh|bash)$

  # Shell script formatting with shfmt
  - repo: https://github.com/scop/pre-commit-shfmt
    rev: v3.12.0-2
    hooks:
      - id: shfmt
        args: ['-i', '2', '-ci', '-w']
        # -i 2: indent with 2 spaces
        # -ci: indent switch cases
        # -w: write result to file instead of stdout
        types: [shell]
        files: \.(sh|bash)$

  # Dockerfile linting with hadolint
  # Uses wrapper script that works with local binary, Docker, or Podman
  # Automatically skipped if no Dockerfiles present
  - repo: local
    hooks:
      - id: hadolint
        name: hadolint
        entry: .hadolint-wrapper.sh
        language: script
        files: Dockerfile
        args: ['--ignore', 'DL3008', '--ignore', 'DL3018']
        # DL3008: Pin versions in apt-get install
        # DL3018: Pin versions in apk add

  # YAML linting with yamllint
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint


  # Markdown linting
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.46.0
    hooks:
      - id: markdownlint
        args: ['--fix']

  # GitHub Actions workflow linting
  - repo: https://github.com/rhysd/actionlint
    rev: v1.7.9
    hooks:
      - id: actionlint

  # Secret detection with gitleaks
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.30.0
    hooks:
      - id: gitleaks

  # Python linting with ruff (only runs if .py files present)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.8
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  # Pre-push hooks - Second line of defense for branch protection
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # Prevent pushes to protected branches (defense-in-depth)
      - id: no-commit-to-branch
        args: ['--branch', 'main', '--branch', 'master']
        stages: [pre-push]

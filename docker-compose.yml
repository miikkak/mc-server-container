# Minimal docker-compose.yml example for mc-server-container
# This container focuses on JVM configuration only.
# Minecraft-specific configuration (server.properties, plugins, etc.) should be
# managed manually or via helper scripts from check-minecraft-versions repo.

services:
  minecraft:
    image: ghcr.io/miikkak/mc-server-container:latest
    container_name: minecraft-server
    restart: unless-stopped

    # Enable TTY for Paper's colored console output and terminal features
    # Comment out if using log aggregation or if colors cause issues
    tty: true

    # Port mappings
    ports:
      - "25565:25565/tcp"  # Minecraft server
      - "25565:25565/udp"  # Minecraft server (UDP)
      - "25575:25575/tcp"  # RCON

    # Volume mount
    # IMPORTANT: Before first run, create ./data/eula.txt with content: eula=true
    # Ensure ./data contains: paper.jar, eula.txt, and server configs
    volumes:
      - ./data:/data

    # JVM Configuration
    environment:
      # Memory allocation (default: 16G)
      MEMORY: "16G"

      # OpenTelemetry configuration (optional)
      # The agent is ENABLED by default but requires a configuration file.
      # Create /data/otel-config.properties with your settings, then set:
      OTEL_JAVAAGENT_CONFIGURATION_FILE: "/data/otel-config.properties"
      #
      # Example /data/otel-config.properties content:
      # otel.service.name=minecraft-server
      # otel.exporter.otlp.endpoint=http://otel-collector:4317
      # otel.exporter.otlp.protocol=grpc
      # otel.resource.attributes=deployment.environment=production
      # otel.metrics.exporter=otlp
      # otel.logs.exporter=otlp
      # otel.traces.exporter=otlp

      # Advanced JVM tuning (uncomment for troubleshooting only)
      # DISABLE_MEOWICE_FLAGS: "true"          # Disable MeowIce G1GC optimizations
      # DISABLE_MEOWICE_GRAALVM_FLAGS: "true"  # Disable GraalVM-specific optimizations
      # DISABLE_OTEL_AGENT: "true"             # Disable OpenTelemetry Java agent
      # JAVA_OPTS_CUSTOM: "-Xlog:gc*"         # Add custom JVM options

    # Resource limits (optional but recommended for production)
    deploy:
      resources:
        limits:
          memory: 24G  # Should be higher than MEMORY setting to allow overhead
        reservations:
          memory: 16G

# Example production setup with networks and additional volumes
#
# services:
#   minecraft:
#     image: ghcr.io/miikkak/mc-server-container:latest
#     container_name: minecraft-cubeschool
#     restart: unless-stopped
#     tty: true  # Enable colored console output
#
#     networks:
#       - minecraft4
#       - minecraft6
#
#     ports:
#       - "25565:25565/tcp"
#       - "25565:25565/udp"
#       - "25575:25575/tcp"
#
#     volumes:
#       - /srv/minecraft:/data
#       - /srv/bluemap:/data/bluemap  # External volume for BlueMap
#
#     environment:
#       MEMORY: "16G"
#       OTEL_JAVAAGENT_CONFIGURATION_FILE: "/data/otel-config.properties"
#       # Create /data/otel-config.properties with your OpenTelemetry settings
#
#     deploy:
#       resources:
#         limits:
#           memory: 24G
#         reservations:
#           memory: 16G
#
# networks:
#   minecraft4:
#     external: true
#   minecraft6:
#     external: true

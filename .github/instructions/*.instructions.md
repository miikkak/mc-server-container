# Copilot Review Instructions (baseline)

Purpose

- Automated-first review focusing on shell scripts (ShellCheck), Dockerfile (Hadolint), docker-compose validation, and CI build/test success.
- Provide reproducible commands and small patchable fixes.

Scope

- All shell scripts (*.sh, entrypoints), Dockerfile(s), docker-compose*.yml, and CI workflow files.

What to run

- ShellCheck: `shellcheck -x -s bash path/to/file.sh`
- Hadolint: `hadolint Dockerfile` or `docker run --rm -i hadolint/hadolint < Dockerfile`
- Compose validation: `docker compose -f docker-compose.yml config`
- Build: `docker build --pull -t repo/pr-<id> .`
- Scan: `trivy image --severity HIGH,CRITICAL --exit-code 1 repo/pr-<id>`

Output format expected from Copilot

1. Summary: counts of issues by type (ShellCheck/Hadolint/compose/build/tests/scans).
2. For each issue:
   - file:line
   - tool + rule id (e.g., ShellCheck SC2086, Hadolint DL3008)
   - severity (Critical/High/Medium/Low)
   - explanation in plain English
   - exact command to reproduce
   - suggested fix as a unified diff or code block
3. If a change is non-trivial (requires new test or CI change), provide:
   - a patch for the test/CI change
   - notes on how to run the new tests locally and in CI

Decision guidance

- Block merge on Critical/High issues unless an approver explicitly signs off.
- Lower severity issues can be addressed in follow-up PRs if core functionality and tests are green, but list them.

Examples of common fixes

- Shell: add quotes around variable expansions, use arrays for arguments, add "set -euo pipefail".
- Dockerfile: pin base image, use multi-stage builds, remove apt lists, create non-root user.
- Compose: move env vars to env_file, use secrets, validate config schema.

Template prompt (copy/paste for Copilot)
"You are performing a code review. Check all shell scripts using ShellCheck, Dockerfiles with Hadolint, validate docker-compose.yml, and ensure CI build + tests + container scans will pass. For each finding provide file:line, tool+rule, severity, explain why it matters, give exact reproduce command, and a suggested patch (unified diff or code block). If you cannot assert runtime behavior, list precise commands a maintainer should run in CI to verify. Do not change behavior without tests."

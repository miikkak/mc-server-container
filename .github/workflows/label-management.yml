name: Label Management

on:
  pull_request:
    types: [synchronize]

jobs:
  remove-ci-ready:
    runs-on: ubuntu-slim
    if: contains(github.event.pull_request.labels.*.name, 'ci/ready')
    permissions:
      pull-requests: write
      issues: write
    steps:
      - name: Remove ci/ready label
        run: |
          gh pr edit ${{ github.event.pull_request.number }} \
            --repo ${{ github.repository }} \
            --remove-label "ci/ready"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Comment on PR
        run: |
          COMMENT="ðŸ”„ New commits detected. The \`ci/ready\` label has been removed."
          COMMENT="$COMMENT Please re-add the label when ready to trigger the full CI/CD pipeline."
          gh pr comment ${{ github.event.pull_request.number }} \
            --repo ${{ github.repository }} \
            --body "$COMMENT"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
